<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Debug Video Preview</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; padding: 18px; }
      .container { max-width: 900px; margin: 0 auto; }
      video { width: 100%; border: 1px solid #ccc; background: #000; }
      .info { margin-top: 8px; display:flex; gap:12px; align-items:center; }
      .badge { background:#111; color:#fff; padding:6px 10px; border-radius:6px; font-weight:600; }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Debug Video Preview</h2>
      <video id="debugVideo" controls playsinline muted>
        <source src="./Screen recording 2025-12-02 08.36.09.webm" type="video/webm">
        Your browser does not support the video tag.
      </video>
      <div class="info">
        <div class="badge" id="playState">Paused</div>
        <div>Current time: <span id="time">0.00</span>s</div>
        <div>Frame counter: <span id="counter">0</span></div>
      </div>
    </div>

    <script>
      const v = document.getElementById('debugVideo');
      const playState = document.getElementById('playState');
      const timeEl = document.getElementById('time');
      const counterEl = document.getElementById('counter');
      let raf = null;
      let frameCounter = 0;

      function update() {
        timeEl.textContent = v.currentTime.toFixed(2);
        // increment a simple counter when video is playing to help spot flicker timing
        if (!v.paused && !v.ended) {
          frameCounter++;
          counterEl.textContent = frameCounter;
        }
        raf = requestAnimationFrame(update);
      }

      v.addEventListener('play', () => {
        playState.textContent = 'Playing';
        if (!raf) raf = requestAnimationFrame(update);
      });
      v.addEventListener('pause', () => { playState.textContent = 'Paused'; });
      v.addEventListener('ended', () => { playState.textContent = 'Ended'; });

      // show immediately if autoplay or manual play
      if (!v.paused) { playState.textContent = 'Playing'; if (!raf) raf = requestAnimationFrame(update); }
    
      function downloadDataUrl(url, filename){
        try {
          const parts = url.split(',');
          const meta = parts[0];
          const data = parts[1];
          const mimeMatch = meta.match(/:(.*?);/);
          const mime = mimeMatch ? mimeMatch[1] : 'image/png';
          const byteString = atob(data);
          const ab = new ArrayBuffer(byteString.length);
          const ia = new Uint8Array(ab);
          for (let i = 0; i < byteString.length; i++) ia[i] = byteString.charCodeAt(i);
          const blob = new Blob([ab], { type: mime });
          const objUrl = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = objUrl;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(() => { try { URL.revokeObjectURL(objUrl); } catch (e) {} }, 1500);
          return;
        } catch (err) {
          console.warn('Blob download failed, falling back to direct open', err);
        }
        const w = window.open(url, '_blank');
        if (!w) alert('Download blocked; right-click the image and choose "Save image as..."');
      }
    </script>
  </body>
</html>
